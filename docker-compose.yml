version: '3.8'

services: 
  web:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: photo_backend
    restart: unless-stopped
    env_file:
      - .env
    volumes:
      - ./data/db:/app/db
      - ./data/media:/app/media
      - ./backend:/app
    ports:
      - '8000:8000'
    command: >
      sh -c "python manage.py migrate --noinput && python manage.py collectstatic --noinput && gunicorn config.wsgi:application --bind 0.0.0.0:8000 --workers 3"
