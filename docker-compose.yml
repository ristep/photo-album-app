version: '3.8'

services: 
  web:
    build:
      context: ./backend
      dockerfile: Dockerfile
      args:
        USER_ID: 30033
        GROUP_ID: 30033
    container_name: photo_backend
    restart: unless-stopped
    user: "30033:30033"
    env_file:
      - .env
    volumes:
      - ./data/db:/app/db
      - ./data/media:/app/media
      - ./backend:/app
    ports:
      - '8000:8000'
    # command: sh -c "python manage.py migrate --noinput && python manage.py collectstatic --noinput && gunicorn config.wsgi:application --bind 0.0.0.0:8000 --workers 3"
    command: python manage.py runserver 0.0.0.0:8000

  tailwind:
    build:
      context: ./backend
      dockerfile: Dockerfile
      args:
        USER_ID: 30033
        GROUP_ID: 30033
    container_name: photo_tailwind
    restart: unless-stopped
    user: "30033:30033"
    env_file:
      - .env
    volumes:
      - ./data/db:/app/db
      - ./data/media:/app/media
      - ./backend:/app
    working_dir: /app/theme/static_src
    command: npm run dev
    environment:
      - NPM_CONFIG_UPDATE_NOTIFIER=false
      - NPM_CONFIG_FUND=false
    tty: true
